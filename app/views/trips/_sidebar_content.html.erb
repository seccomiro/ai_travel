<div id="trip-sidebar-content">
  <!-- Trip Overview -->
  <div class="card mb-3">
    <div class="card-body">
      <h6 class="card-title"><%= t('trips.overview') %></h6>
      <div class="row text-center mb-3">
        <div class="col-4">
          <div class="border rounded p-2">
            <h6 class="text-muted mb-0"><%= t('trips.days') %></h6>
            <span class="fs-5 fw-bold">
              <%= trip.start_date && trip.end_date ? (trip.end_date - trip.start_date).to_i + 1 : '-' %>
            </span>
          </div>
        </div>
        <div class="col-4">
          <div class="border rounded p-2">
            <h6 class="text-muted mb-0"><%= t('trips.segments') %></h6>
            <span class="fs-5 fw-bold" id="trip-segments-count">
              <%= trip.trip_data.dig('current_route', 'destinations')&.length || 0 %>
            </span>
          </div>
        </div>
        <div class="col-4">
          <div class="border rounded p-2">
            <h6 class="text-muted mb-0"><%= t('trips.status_label') %></h6>
            <span class="badge bg-primary" id="trip-status-badge">
              <%= t("trips.status.#{trip.status}") %>
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Route Map -->
  <div class="card mb-3">
    <div class="card-body">
      <h6 class="card-title"><%= t('trips.route_map') %></h6>
      <div
        id="google-map"
        class="rounded"
        style="height: 250px; background-color: #f0f0f0;"
        data-controller="google-map"
        data-google-map-api-key-value="<%= Rails.application.credentials.google_maps_api_key %>"
        data-google-map-route-value="<%= trip.trip_data.dig('current_route')&.to_json || '{}' %>"
        data-google-map-route-id-value="<%= trip.trip_data.dig('current_route', 'id') %>"
      ></div>
    </div>
  </div>

  <!-- Trip Details -->
  <div class="card">
    <div class="card-body">
      <div class="trip-details">
        <h5 class="card-title"><%= trip.title %></h5>
        <% if trip.description.present? %>
          <p class="card-text text-muted"><%= trip.description %></p>
        <% end %>

        <hr>

        <dl class="row">
          <% if trip.start_date.present? && trip.end_date.present? %>
            <dt class="col-sm-4"><%= t('trips.sidebar.dates') %></dt>
            <dd class="col-sm-8"><%= l(trip.start_date, format: :short) %> - <%= l(trip.end_date, format: :short) %></dd>
          <% end %>

          <% if trip.trip_data['trip_type'].present? %>
            <dt class="col-sm-4"><%= t('trips.sidebar.trip_type') %></dt>
            <dd class="col-sm-8 text-capitalize"><%= trip.trip_data['trip_type'].gsub('_', ' ') %></dd>
          <% end %>

          <% if trip.trip_data['pace'].present? %>
            <dt class="col-sm-4"><%= t('trips.sidebar.pace') %></dt>
            <dd class="col-sm-8 text-capitalize"><%= trip.trip_data['pace'].gsub('_', ' ') %></dd>
          <% end %>

          <% if trip.trip_data['current_route'].present? %>
            <dt class="col-sm-4"><%= t('trips.sidebar.route') %></dt>
            <dd class="col-sm-8">
              <% destinations = trip.trip_data.dig('current_route', 'destinations') %>
              <% if destinations.present? %>
                <%= destinations.first %> â†’ <%= destinations.last %>
                <% if destinations.length > 2 %>
                  <small class="text-muted d-block">via <%= destinations[1..-2].join(', ') %></small>
                <% end %>
              <% end %>
            </dd>
          <% end %>

          <% if trip.trip_data['group_composition'].present? %>
            <dt class="col-sm-4"><%= t('trips.sidebar.travelers') %></dt>
            <dd class="col-sm-8">
              <% group = trip.trip_data['group_composition'] %>
              <% parts = [] %>
              <% parts << "#{group['adults']} adult#{group['adults'] != 1 ? 's' : ''}" if group['adults']&.positive? %>
              <% parts << "#{group['children']&.length || 0} child#{group['children']&.length != 1 ? 'ren' : ''}" if group['children']&.any? %>
              <% parts << "#{group['infants']} infant#{group['infants'] != 1 ? 's' : ''}" if group['infants']&.positive? %>
              <% parts << "#{group['pets']&.length || 0} pet#{group['pets']&.length != 1 ? 's' : ''}" if group['pets']&.any? %>
              <%= parts.join(', ') %>
            </dd>
          <% elsif trip.trip_data['travelers'].present? %>
            <dt class="col-sm-4"><%= t('trips.sidebar.travelers') %></dt>
            <dd class="col-sm-8"><%= trip.trip_data['travelers'] %></dd>
          <% end %>

          <% if trip.trip_data['budget_profile'].present? %>
            <dt class="col-sm-4"><%= t('trips.sidebar.budget') %></dt>
            <dd class="col-sm-8 text-capitalize">
              <%= trip.trip_data['budget_profile'].gsub('-', ' ') %>
              <% if trip.trip_data['total_budget'].present? %>
                <small class="text-muted d-block">
                  <%= trip.trip_data['currency'] || 'USD' %> <%= trip.trip_data['total_budget'] %>
                </small>
              <% end %>
            </dd>
          <% elsif trip.trip_data['budget'].present? %>
            <dt class="col-sm-4"><%= t('trips.sidebar.budget') %></dt>
            <dd class="col-sm-8 text-capitalize"><%= trip.trip_data['budget'] %></dd>
          <% end %>
        </dl>

        <% if trip.trip_data['categories'].present? %>
          <h6><%= t('trips.sidebar.categories') %></h6>
          <div class="d-flex flex-wrap">
            <% trip.trip_data['categories'].each do |category| %>
              <span class="badge bg-primary me-2 mb-2"><%= category.titleize %></span>
            <% end %>
          </div>
        <% end %>

        <% if trip.trip_data['specific_interests'].present? %>
          <h6 class="mt-3"><%= t('trips.sidebar.interests') %></h6>
          <div class="d-flex flex-wrap">
            <% trip.trip_data['specific_interests'].each do |interest| %>
              <span class="badge bg-light text-dark me-2 mb-2"><%= interest.titleize %></span>
            <% end %>
          </div>
        <% elsif trip.trip_data['interests'].present? %>
          <h6 class="mt-3"><%= t('trips.sidebar.interests') %></h6>
          <div class="d-flex flex-wrap">
            <% trip.trip_data['interests'].each do |interest| %>
              <span class="badge bg-light text-dark me-2 mb-2"><%= interest.titleize %></span>
            <% end %>
          </div>
        <% end %>

        <% if trip.trip_data['must_do'].present? %>
          <h6 class="mt-3"><%= t('trips.sidebar.must_do') %></h6>
          <ul class="list-group list-group-flush">
            <% trip.trip_data['must_do'].each do |activity| %>
              <li class="list-group-item"><%= activity %></li>
            <% end %>
          </ul>
        <% elsif trip.trip_data['activities'].present? %>
          <h6 class="mt-3"><%= t('trips.sidebar.activities') %></h6>
          <ul class="list-group list-group-flush">
            <% trip.trip_data['activities'].each do |activity| %>
              <li class="list-group-item"><%= activity %></li>
            <% end %>
          </ul>
        <% end %>

        <% if trip.trip_data['things_to_avoid'].present? %>
          <h6 class="mt-3"><%= t('trips.sidebar.things_to_avoid') %></h6>
          <div class="d-flex flex-wrap">
            <% trip.trip_data['things_to_avoid'].each do |avoid| %>
              <span class="badge bg-warning text-dark me-2 mb-2"><%= avoid.titleize %></span>
            <% end %>
          </div>
        <% end %>

        <% if trip.trip_data['dietary'].present? %>
          <h6 class="mt-3"><%= t('trips.sidebar.dietary') %></h6>
          <div class="d-flex flex-wrap">
            <% trip.trip_data['dietary'].each do |diet| %>
              <span class="badge bg-info text-white me-2 mb-2"><%= diet.titleize %></span>
            <% end %>
          </div>
        <% end %>

        <% if trip.trip_data['accessibility'].present? %>
          <h6 class="mt-3"><%= t('trips.sidebar.accessibility') %></h6>
          <div class="d-flex flex-wrap">
            <% trip.trip_data['accessibility'].each do |access| %>
              <span class="badge bg-secondary me-2 mb-2"><%= access.titleize %></span>
            <% end %>
          </div>
        <% end %>

        <% if trip.trip_data['user_notes'].present? %>
          <h6 class="mt-3"><%= t('trips.sidebar.notes') %></h6>
          <div class="alert alert-light">
            <%= trip.trip_data['user_notes'] %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
